generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            BigInt         @id @default(dbgenerated("public.next_id()"))
  email         String         @unique
  password      String
  name          String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  refreshTokens RefreshToken[]
}

model RefreshToken {
  id        BigInt   @id @default(dbgenerated("public.next_id()"))
  token     String   @unique
  userId    BigInt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  expiresAt DateTime
  revoked   Boolean  @default(false)
}

enum ChannelType {
  DEFAULT
  ONDC
  FLIPKART
  AMAZON_IN
  WOOCOMMERCE
  WIX
  SHOPIFY

  @@map("channel_type")
}

enum LogisticsProviderType {
  SHIPROCKET

  @@map("logistics_provider_type")
}

enum PaymentGatewayProviderType {
  RAZORPAY
  CASHFREE

  @@map("payment_gateway_provider_type")
}

enum Status {
  ENABLED
  DISABLED

  @@map("status")
}

enum StoreStatus {
  ACTIVE
  DELETED
  SUSPENDED
  BANNED

  @@map("store_status")
}

enum ProductStatus {
  DRAFT
  ACTIVE
  DELETED

  @@map("product_status")
}

enum AssetType {
  IMAGE
  VIDEO

  @@map("asset_type")
}

enum InventoryStrategyType {
  UNIFIED
  SPLIT

  @@map("inventory_strategy_type")
}

enum PriceStrategyType {
  UNIFIED
  SPLIT

  @@map("price_strategy_type")
}

enum OndcOrderStatus {
  CREATED
  IN_PROGRESS
  COMPLETED
  CANCELLED

  @@map("ondc_order_status")
}

enum AmazonOrderStatus {
  PENDING
  UNSHIPPED
  WAITING_FOR_PICKUP
  PICKED_UP
  DELIVERED
  CANCELLED

  @@map("amazon_order_status")
}

enum FlipkartOrderStatus {
  APPROVED
  PACKING_IN_PROGRESS
  PACKED
  READY_TO_DISPATCH
  SHIPPED
  DELIVERED
  CANCELLED
  RETURN_CREATED
  RETURN_COMPLETED
  RETURN_CANCELLED

  @@map("flipkart_order_status")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  RETURNED

  @@map("order_status")
}

enum FulfillmentStatus {
  PENDING
  PACKING
  READY_TO_DISPATCH
  PICKED_UP
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
  RETURN_INITIATED
  RETURN_APPROVED
  RETURN_REJECTED
  RETURN_PICKED_UP
  RETURN_DELIVERED

  @@map("fulfillment_status")
}

enum PaymentMethod {
  COD
  CVS
  OTHER

  @@map("payment_method")
}

enum AdminReportStatus {
  PENDING
  COMPLETED
  FAILED

  @@map("admin_report_status")
}

enum ExternalProductIdType {
  EAN
  UPC
  GTIN
  ISBN

  @@map("external_product_id_type")
}

model SalesChannelProvider {
  id             BigInt      @id @default(dbgenerated("public.next_id()"))
  token          ChannelType @unique
  name           String
  shortDesc      String      @map("short_desc")
  longDesc       String      @map("long_desc")
  logoUri        String      @map("logo_uri")
  infoUrl        String      @map("info_url")
  integrationUrl String      @map("integration_url")
  active         Boolean     @default(false)
  createdBy      String      @map("created_by")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("sales_channel_provider")
}

model LogisticsProvider {
  id             BigInt                @id @default(dbgenerated("public.next_id()"))
  token          LogisticsProviderType @unique
  name           String
  shortDesc      String                @map("short_desc")
  longDesc       String                @map("long_desc")
  logoUri        String                @map("logo_uri")
  infoUrl        String                @map("info_url")
  integrationUrl String                @map("integration_url")
  active         Boolean               @default(false)
  createdBy      String                @map("created_by")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("logistics_provider")
}

model PaymentGatewayProvider {
  id             BigInt                     @id @default(dbgenerated("public.next_id()"))
  token          PaymentGatewayProviderType @unique
  name           String
  shortDesc      String                     @map("short_desc")
  longDesc       String                     @map("long_desc")
  logoUri        String                     @map("logo_uri")
  infoUrl        String                     @map("info_url")
  integrationUrl String                     @map("integration_url")
  active         Boolean                    @default(false)
  createdBy      String                     @map("created_by")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("payment_gateway_provider")
}

model Category {
  id          BigInt        @id @default(dbgenerated("public.next_id()"))
  name        String
  active      Boolean       @default(false)
  storeId     BigInt?       @map("store_id")
  subCategory SubCategory[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([name, storeId])
  @@map("category")
}

model SubCategory {
  id         BigInt  @id @default(dbgenerated("public.next_id()"))
  name       String
  categoryId BigInt  @map("category_id")
  active     Boolean @default(false)
  storeId    BigInt? @map("store_id")

  /// [SubCategoryMetadata]
  metadata   Json     @db.JsonB
  attributes String[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  variantOption VariantOptionOnSubCategory[]
  category      Category                     @relation(fields: [categoryId], references: [id])

  @@unique([name, storeId])
  @@map("sub_category")
}

model VariantOptionOnSubCategory {
  id              BigInt  @id @default(dbgenerated("public.next_id()"))
  typeName        String  @map("type_name")
  variantOptionId BigInt  @map("variant_option_id")
  storeId         BigInt? @map("store_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  subCategory   SubCategory?  @relation(fields: [typeName, storeId], references: [name, storeId])
  variantOption VariantOption @relation(fields: [variantOptionId], references: [id])

  @@unique([typeName, variantOptionId, storeId])
  @@map("variant_option_on_sub_category")
}

model VariantOption {
  id            BigInt  @id @default(dbgenerated("public.next_id()"))
  storeId       BigInt? @map("store_id")
  name          String
  attributeName String  @map("attribute_name")
  gender        String
  brand         String
  values        Json    @db.JsonB

  editable  Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  subCategory VariantOptionOnSubCategory[]

  @@unique([name, storeId])
  @@map("variant_option")
}

model Store {
  id     BigInt @id @default(dbgenerated("public.next_id()"))
  userId BigInt @unique

  enabledChannels ChannelType[] @map("enabled_channels")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("store")
}

model Asset {
  storeId   BigInt  @map("store_id")
  productId BigInt? @map("product_id")
  variantId BigInt? @map("variant_id")

  id        BigInt    @id @default(dbgenerated("public.next_id()"))
  type      AssetType
  position  Int       @default(0)
  uri       String
  metadata  Json?     @db.JsonB
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  product Product? @relation(fields: [productId], references: [id])
  variant Variant? @relation(fields: [variantId], references: [id])

  @@map("asset")
}

model Product {
  storeId            BigInt                 @map("store_id")
  id                 BigInt                 @id @default(dbgenerated("public.next_id()"))
  title              String
  description        String
  slug               String
  status             ProductStatus          @default(DRAFT)
  hsnCode            String                 @map("hsn_code")
  subCategoryId      BigInt                 @map("sub_category_id")
  categoryId         BigInt                 @map("category_id")
  inventoryStrategy  InventoryStrategyType? @default(UNIFIED) @map("inventory_strategy")
  priceStrategy      PriceStrategyType?     @default(UNIFIED) @map("price_strategy")
  variationAttribute String[]               @map("variation_attribute")
  brandName          String                 @map("brand_name")
  productMeasurement Json                   @map("product_measurement") @db.JsonB()

  manufacturingInfo Json @map("manufacturing_info") @db.JsonB()

  originCountry String?  @map("origin_country")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  assets   Asset[]
  variants Variant[]

  @@map("product")
}

model Variant {
  id        BigInt        @id @default(dbgenerated("public.next_id()"))
  storeId   BigInt        @map("store_id")
  productId BigInt        @map("product_id")
  sku       String
  option    Json          @db.JsonB
  extraData Json?         @db.JsonB
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")
  assets    Asset[]
  channels  ChannelType[]
  product   Product       @relation(fields: [productId], references: [id])

  externalProductIdentifier ExternalProductIdentifier[]

  @@unique([storeId, sku])
  @@map("variant")
}

model ExternalProductIdentifier {
  id        BigInt                @id @default(dbgenerated("public.next_id()"))
  variantId BigInt                @map("variant_id")
  storeId   BigInt                @map("store_id")
  type      ExternalProductIdType
  value     String

  variant Variant @relation(fields: [variantId], references: [id])

  @@unique([storeId, type, value])
  @@map("external_product_identifier")
}

enum InventoryTransactionType {
  ADD
  REMOVE
  ALLOCATION
  SALE
  CANCELLATION
  RELEASE

  @@map("inventory_transaction_type")
}

enum ChannelStatus {
  ACTIVE
  INACTIVE

  @@map("channel_status")
}

model Inventory {
  id            BigInt        @id @default(dbgenerated("public.next_id()"))
  storeId       BigInt        @map("store_id")
  variantId     BigInt        @map("variant_id")
  channelType   ChannelType   @map("channel_type")
  channelStatus ChannelStatus @default(ACTIVE) @map("channel_status")
  onHand        Int           @map("on_hand")
  allocated     Int           @default(0)

  transactions InventoryTransaction[]
  createdAt    DateTime               @default(now()) @map("created_at")
  updatedAt    DateTime               @updatedAt @map("updated_at")

  @@unique([storeId, channelType, variantId])
  @@map("inventory")
}

model InventoryTransaction {
  id          BigInt                   @id @default(dbgenerated("public.next_id()"))
  storeId     BigInt                   @map("store_id")
  quantity    Int
  type        InventoryTransactionType
  inventoryId BigInt                   @map("inventory_id")
  metadata    Json                     @db.JsonB
  inventory   Inventory                @relation(fields: [inventoryId], references: [id])
  createdAt   DateTime                 @default(now()) @map("created_at")
  updatedAt   DateTime                 @updatedAt @map("updated_at")

  @@map("inventory_transaction")
}

model Price {
  id            BigInt        @id @default(dbgenerated("public.next_id()"))
  storeId       BigInt        @map("store_id")
  variantId     BigInt        @map("variant_id")
  channelType   ChannelType   @map("channel_type")
  channelStatus ChannelStatus @default(ACTIVE) @map("channel_status")

  mrp   Int
  price Int

  priceUpdates PriceUpdate[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([storeId, channelType, variantId])
  @@map("price")
}

model PriceUpdate {
  id        BigInt   @id @default(dbgenerated("public.next_id()"))
  mrp       Int
  price     Int
  priceId   BigInt   @map("price_id")
  storeId   BigInt   @map("store_id")
  metadata  Json     @db.JsonB
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  priceEntity Price @relation(fields: [priceId], references: [id])

  @@map("price_update")
}

model CategoryAttribute {
  id             BigInt   @id @default(dbgenerated("public.next_id()"))
  code           String   @unique
  domain         String
  name           String
  required       String[]
  properties     String[]
  enumProperties String[] @map("enum_properties")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  @@map("category_attribute")
}

model CategoryAttributeEnumValue {
  id     BigInt   @id @default(dbgenerated("public.next_id()"))
  code   String
  name   String
  values String[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([code, name])
  @@map("category_attribute_enum_value")
}
